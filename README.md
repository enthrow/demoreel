# ðŸŽ¬ DemoReel

This is a [PyO3] module that parses .dem packet traces (demo-files) generated by
Source games using [demostf/parser][demostf], yields them as Python objects, and rolls
wheels using [maturin], motivated by the need for integration into
[MAC/Jensen][jensen]. 

Using this library, data storage and annotation can be decoupled from the batch
processing of the demo-files, avoiding the introduction of a domain-specific
format for training of AI models, and hopefully helping separate the concerns of
individual applications consuming such data from the pipelines producing and
ingesting it. 

Currently filters out everything except user input, following operational
principles of https://donadigo.com/tmx1. This is subject to change, but
intuitively, if a player performs 3 consecutive frame-perfect b-hops or snaps of
their barrel between the player position closest to their current view angle and
some other random direction in a small cone, then you probably don't actually
need to know how much damage they did in order to identify that they're hacking.


## Installation

Haha, you thought. Nah, but this this is actually a build section. You can only
install from source.

in the project root:
```sh
$ python3 -m venv venv # optional: create a virtual environment
$ . venv/bin/activate  # you can also activate a different one obviously
$ pip install maturin
$ maturin develop --release  # this should automatically build and install a wheel for you
```

This will build a wheel in the `targets/` subdirectory that you can `pip
install` in other virtual environments. Or if you prefer, you can just run your
application code in this source tree. Go ahead. I'm not the file police.

## Python Usage

```py
import demoreel

demo_path = REPLACE_ME
with open(demo_path, "rb") as istrm:
    demo_data = istrm.read()

# unintelligible garbage, recommend wrangling it with https://pola.rs/
inputs = demoreel.unspool(demo_data, tick_freq="$.players[*][?(@.class!='other')]")
```

### TODO
- Surface intra-tick player input again for each player's state

[maturin]: https://maturin.rs/
[pyo3]: https://pyo3.rs/
[jpath]: https://docs.rs/serde_json_path/
[jensen]: https://github.com/megascatterbomb/MegaAntiCheat/
[demostf]: https://github.com/demostf/parser